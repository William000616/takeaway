<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hjx.takeout.mapper.OrderMapper">

    <!--根据用户id查询所有order-->
    <select id="list" resultType="com.hjx.takeout.entity.Order">
        select order_takeout.*,shop.logo_src,shop.shop_name from order_takeout,shop
        <where>
            <if test="order_Number!=null and order_Number != ''">
                order_takeout.order_Number like concat('%',#{order_Number},'%')
            </if>
            <if test="u_id!=null and u_id != ''">
                and order_takeout.u_id = #{u_id}
            </if>
            and shop.s_id = order_takeout.s_id
        </where>
    </select>

    <!--根据用户sid查询所有order-->
    <select id="listAdd" resultType="com.hjx.takeout.entity.Order">
        select order_takeout.*,address.address from order_takeout,address
        <where>
            <if test="order_Number!=null and order_Number != ''">
                order_takeout.order_Number like concat('%',#{order_Number},'%')
            </if>
            <if test="s_id!=null and s_id != ''">
                and order_takeout.s_id = #{s_id}
            </if>
            and order_Stat != 1
            and address.a_id = order_takeout.a_id
        </where>
    </select>

    <!--根据用户sid查询所有新order-->
    <select id="listNew" resultType="com.hjx.takeout.entity.Order">
        select order_takeout.*,address.address from order_takeout,address
        <where>
            <if test="order_Number!=null and order_Number != ''">
                order_takeout.order_Number like concat('%',#{order_Number},'%')
            </if>
            <if test="s_id!=null and s_id != ''">
                and order_takeout.s_id = #{s_id}
            </if>
            and order_Stat = 1
            and address.a_id = order_takeout.a_id
        </where>
    </select>

    <!--根据orderId查询所有good-->
    <select id="listById" resultType="com.hjx.takeout.entity.GoodOrder">
        select order_good.*,good.good_name,good.price from order_good,good where order_good.o_id = #{o_id} and good.g_id=order_good.g_id
    </select>

    <!--商家接单-->
    <update id="shopPickOrder">
        update order_takeout set order_Stat = 2,order_time = #{order_time}
        where o_id = #{o_id}
    </update>

    <!--商家修改订单状态-->
    <update id="changeOrderState">
        update order_takeout set order_Stat = #{order_Stat},arrive_time = #{arrive_time}
        where o_id = #{o_id}
    </update>

<!--    &lt;!&ndash;添加good&ndash;&gt;-->
<!--    <insert id="add">-->
<!--        insert into good(good_name,good_pic,price,c_id,sales,s_id) values (#{good_name},#{good_pic},#{price},#{c_id},0,#{s_id})-->
<!--    </insert>-->

<!--    &lt;!&ndash;根据uid删除good&ndash;&gt;-->
<!--    <delete id="delete">-->
<!--        delete from good where g_id = #{g_id}-->
<!--    </delete>-->
</mapper>